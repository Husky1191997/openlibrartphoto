{"version":3,"sources":["BottomSheetModal.tsx"],"names":["React","forwardRef","memo","useCallback","useImperativeHandle","useMemo","useRef","useState","Portal","nanoid","isEqual","BottomSheet","useBottomSheetModalInternal","DEFAULT_DISMISS_ON_PAN_DOWN","BottomSheetModalComponent","props","ref","name","dismissOnPanDown","onDismiss","_providedOnDismiss","index","_providedIndex","snapPoints","_providedSnapPoints","onChange","_providedOnChange","children","bottomSheetProps","mount","setMount","containerHeight","mountSheet","unmountSheet","willUnmountSheet","bottomSheetRef","isMinimized","isForcedDismissed","currentIndexRef","key","doDismiss","current","handleOnChange","_index","adjustedIndex","handleMinimize","close","handleRestore","snapTo","handlePresent","requestAnimationFrame","handleDismiss","force","handleClose","handleCollapse","collapse","handleExpand","expand","handleSnapTo","present","dismiss","minimize","restore","BottomSheetModal"],"mappings":";;AAAA,OAAOA,KAAP,IACEC,UADF,EAEEC,IAFF,EAGEC,WAHF,EAIEC,mBAJF,EAKEC,OALF,EAMEC,MANF,EAOEC,QAPF,QAQO,OARP;AASA,SAASC,MAAT,QAAuB,gBAAvB;AACA,SAASC,MAAT,QAAuB,mBAAvB;AACA,OAAOC,OAAP,MAAoB,gBAApB;AACA,OAAOC,WAAP,MAAwB,gBAAxB;AACA,SAASC,2BAAT,QAA4C,aAA5C;AACA,SAASC,2BAAT,QAA4C,aAA5C;AAMA,MAAMC,yBAAyB,gBAAGb,UAAU,CAG1C,CAACc,KAAD,EAAQC,GAAR,KAAgB;AAChB,QAAM;AACJ;AACAC,IAAAA,IAFI;AAGJC,IAAAA,gBAAgB,GAAGL,2BAHf;AAIJM,IAAAA,SAAS,EAAEC,kBAJP;AAMJ;AACAC,IAAAA,KAAK,EAAEC,cAAc,GAAG,CAPpB;AAQJC,IAAAA,UAAU,EAAEC,mBARR;AASJC,IAAAA,QAAQ,EAAEC,iBATN;AAWJ;AACAC,IAAAA,QAZI;AAaJ,OAAGC;AAbC,MAcFb,KAdJ,CADgB,CAiBhB;;AACA,QAAM,CAACc,KAAD,EAAQC,QAAR,IAAoBvB,QAAQ,CAAC,KAAD,CAAlC,CAlBgB,CAmBhB;;AAEA,QAAM;AACJwB,IAAAA,eADI;AAEJC,IAAAA,UAFI;AAGJC,IAAAA,YAHI;AAIJC,IAAAA;AAJI,MAKFtB,2BAA2B,EAL/B,CArBgB,CA4BhB;;AACA,QAAMuB,cAAc,GAAG7B,MAAM,CAAc,IAAd,CAA7B;AACA,QAAM8B,WAAW,GAAG9B,MAAM,CAAC,KAAD,CAA1B;AACA,QAAM+B,iBAAiB,GAAG/B,MAAM,CAAC,KAAD,CAAhC;AACA,QAAMgC,eAAe,GAAGhC,MAAM,CAAC,CAAC,CAAF,CAA9B,CAhCgB,CAiChB;AAEA;;AACA,QAAMiC,GAAG,GAAGlC,OAAO,CAAC,MAAMY,IAAI,iCAA0BR,MAAM,EAAhC,CAAX,EAAiD,CAACQ,IAAD,CAAjD,CAAnB;AACA,QAAMI,KAAK,GAAGhB,OAAO,CACnB,MAAOa,gBAAgB,GAAGI,cAAc,GAAG,CAApB,GAAwBA,cAD5B,EAEnB,CAACA,cAAD,EAAiBJ,gBAAjB,CAFmB,CAArB;AAIA,QAAMK,UAAU,GAAGlB,OAAO,CACxB,MACEa,gBAAgB,GAAG,CAAC,CAAD,EAAI,GAAGM,mBAAP,CAAH,GAAiCA,mBAF3B,EAGxB,CAACA,mBAAD,EAAsBN,gBAAtB,CAHwB,CAA1B,CAzCgB,CA8ChB;AAEA;;AACA,QAAMsB,SAAS,GAAGrC,WAAW,CAAC,MAAM;AAClC,QAAIiB,kBAAJ,EAAwB;AACtBA,MAAAA,kBAAkB;AACnB;;AACDU,IAAAA,QAAQ,CAAC,KAAD,CAAR;AACAG,IAAAA,YAAY,CAACM,GAAD,CAAZ,CALkC,CAOlC;;AACAH,IAAAA,WAAW,CAACK,OAAZ,GAAsB,KAAtB;AACAJ,IAAAA,iBAAiB,CAACI,OAAlB,GAA4B,KAA5B;AACD,GAV4B,EAU1B,CAACF,GAAD,EAAMnB,kBAAN,EAA0Ba,YAA1B,CAV0B,CAA7B;AAWA,QAAMS,cAAc,GAAGvC,WAAW,CAC/BwC,MAAD,IAAoB;AAClB,QAAIP,WAAW,CAACK,OAAZ,IAAuB,CAACJ,iBAAiB,CAACI,OAA9C,EAAuD;AACrD;AACD;;AAED,UAAMG,aAAa,GAAG1B,gBAAgB,GAAGyB,MAAM,GAAG,CAAZ,GAAgBA,MAAtD;AACAL,IAAAA,eAAe,CAACG,OAAhB,GAA0BE,MAA1B;;AAEA,QAAIC,aAAa,IAAI,CAArB,EAAwB;AACtB,UAAIlB,iBAAJ,EAAuB;AACrBA,QAAAA,iBAAiB,CAACkB,aAAD,CAAjB;AACD;AACF,KAJD,MAIO;AACLJ,MAAAA,SAAS;AACV;AACF,GAhB+B,EAiBhC,CAACtB,gBAAD,EAAmBQ,iBAAnB,EAAsCc,SAAtC,CAjBgC,CAAlC,CA5DgB,CA+EhB;AAEA;;AACA,QAAMK,cAAc,GAAG1C,WAAW,CAAC,MAAM;AACvC,QAAI,CAACiC,WAAW,CAACK,OAAjB,EAA0B;AAAA;;AACxBL,MAAAA,WAAW,CAACK,OAAZ,GAAsB,IAAtB;AACA,+BAAAN,cAAc,CAACM,OAAf,gFAAwBK,KAAxB;AACD;AACF,GALiC,EAK/B,EAL+B,CAAlC;AAMA,QAAMC,aAAa,GAAG5C,WAAW,CAAC,MAAM;AACtC,QAAIiC,WAAW,CAACK,OAAhB,EAAyB;AAAA;;AACvBL,MAAAA,WAAW,CAACK,OAAZ,GAAsB,KAAtB;AACA,gCAAAN,cAAc,CAACM,OAAf,kFAAwBO,MAAxB,CAA+BV,eAAe,CAACG,OAA/C;AACD;AACF,GALgC,EAK9B,EAL8B,CAAjC,CAxFgB,CA8FhB;AAEA;;AACA,QAAMQ,aAAa,GAAG9C,WAAW,CAAC,MAAM;AACtC+C,IAAAA,qBAAqB,CAAC,MAAM;AAC1BpB,MAAAA,QAAQ,CAAC,IAAD,CAAR;AACAE,MAAAA,UAAU,CAACO,GAAD,EAAMvB,GAAN,CAAV;AACD,KAHoB,CAArB;AAID,GALgC,EAK9B,CAACuB,GAAD,EAAMP,UAAN,EAAkBhB,GAAlB,CAL8B,CAAjC;AAMA,QAAMmC,aAAa,GAAGhD,WAAW,CAC/B,CAACiD,KAAc,GAAG,KAAlB,KAA4B;AAAA;;AAC1B,QAAIA,KAAJ,EAAW;AACT,UAAIhB,WAAW,CAACK,OAAhB,EAAyB;AACvBD,QAAAA,SAAS;AACT;AACD;;AACDH,MAAAA,iBAAiB,CAACI,OAAlB,GAA4B,IAA5B;AACAL,MAAAA,WAAW,CAACK,OAAZ,GAAsB,KAAtB;AACD,KAPD,MAOO;AACLP,MAAAA,gBAAgB,CAACK,GAAD,CAAhB;AACD;;AACD,8BAAAJ,cAAc,CAACM,OAAf,kFAAwBK,KAAxB;AACD,GAb8B,EAc/B,CAACP,GAAD,EAAMC,SAAN,EAAiBN,gBAAjB,CAd+B,CAAjC;AAgBA,QAAMmB,WAAW,GAAGlD,WAAW,CAAC,MAAM;AAAA;;AACpC,QAAIiC,WAAW,CAACK,OAAhB,EAAyB;AACvB;AACD;;AACD,8BAAAN,cAAc,CAACM,OAAf,kFAAwBK,KAAxB;AACD,GAL8B,EAK5B,EAL4B,CAA/B;AAMA,QAAMQ,cAAc,GAAGnD,WAAW,CAAC,MAAM;AACvC,QAAIiC,WAAW,CAACK,OAAhB,EAAyB;AACvB;AACD;;AACD,QAAIvB,gBAAJ,EAAsB;AAAA;;AACpB,gCAAAiB,cAAc,CAACM,OAAf,kFAAwBO,MAAxB,CAA+B,CAA/B;AACD,KAFD,MAEO;AAAA;;AACL,gCAAAb,cAAc,CAACM,OAAf,kFAAwBc,QAAxB;AACD;AACF,GATiC,EAS/B,CAACrC,gBAAD,CAT+B,CAAlC;AAUA,QAAMsC,YAAY,GAAGrD,WAAW,CAAC,MAAM;AAAA;;AACrC,QAAIiC,WAAW,CAACK,OAAhB,EAAyB;AACvB;AACD;;AACD,8BAAAN,cAAc,CAACM,OAAf,kFAAwBgB,MAAxB;AACD,GAL+B,EAK7B,EAL6B,CAAhC;AAMA,QAAMC,YAAY,GAAGvD,WAAW,CAC7BwC,MAAD,IAAoB;AAAA;;AAClB,QAAIP,WAAW,CAACK,OAAhB,EAAyB;AACvB;AACD;;AACD,8BAAAN,cAAc,CAACM,OAAf,kFAAwBO,MAAxB,CAA+BL,MAAM,IAAIzB,gBAAgB,GAAG,CAAH,GAAO,CAA3B,CAArC;AACD,GAN6B,EAO9B,CAACA,gBAAD,CAP8B,CAAhC,CA7IgB,CAsJhB;AAEA;;AACAd,EAAAA,mBAAmB,CAACY,GAAD,EAAM,OAAO;AAC9B2C,IAAAA,OAAO,EAAEV,aADqB;AAE9BW,IAAAA,OAAO,EAAET,aAFqB;AAG9BL,IAAAA,KAAK,EAAEO,WAHuB;AAI9BL,IAAAA,MAAM,EAAEU,YAJsB;AAK9BD,IAAAA,MAAM,EAAED,YALsB;AAM9BD,IAAAA,QAAQ,EAAED,cANoB;AAO9B;AACAO,IAAAA,QAAQ,EAAEhB,cARoB;AAS9BiB,IAAAA,OAAO,EAAEf;AATqB,GAAP,CAAN,CAAnB,CAzJgB,CAoKhB;AAEA;;AACA,SAAOlB,KAAK,gBACV,oBAAC,MAAD;AAAQ,IAAA,GAAG,EAAEU,GAAb;AAAkB,IAAA,IAAI,EAAEA;AAAxB,kBACE,oBAAC,WAAD,eACMX,gBADN;AAEE,IAAA,GAAG,EAAEO,cAFP;AAGE,IAAA,GAAG,EAAEI,GAHP;AAIE,IAAA,KAAK,EAAElB,KAJT;AAKE,IAAA,UAAU,EAAEE,UALd;AAME,IAAA,cAAc,EAAE,IANlB;AAOE,IAAA,eAAe,EAAEQ,eAPnB;AAQE,IAAA,QAAQ,EAAEW,cARZ;AASE,IAAA,QAAQ,EAAEf;AATZ,KADF,CADU,GAcR,IAdJ;AAeD,CAzL2C,CAA5C;AA2LA,MAAMoC,gBAAgB,gBAAG7D,IAAI,CAACY,yBAAD,EAA4BJ,OAA5B,CAA7B;AAEA,eAAeqD,gBAAf","sourcesContent":["import React, {\n  forwardRef,\n  memo,\n  useCallback,\n  useImperativeHandle,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { Portal } from '@gorhom/portal';\nimport { nanoid } from 'nanoid/non-secure';\nimport isEqual from 'lodash.isequal';\nimport BottomSheet from '../bottomSheet';\nimport { useBottomSheetModalInternal } from '../../hooks';\nimport { DEFAULT_DISMISS_ON_PAN_DOWN } from './constants';\nimport type { BottomSheetModalMethods } from '../../types';\nimport type { BottomSheetModalProps } from './types';\n\ntype BottomSheetModal = BottomSheetModalMethods;\n\nconst BottomSheetModalComponent = forwardRef<\n  BottomSheetModal,\n  BottomSheetModalProps\n>((props, ref) => {\n  const {\n    // modal props\n    name,\n    dismissOnPanDown = DEFAULT_DISMISS_ON_PAN_DOWN,\n    onDismiss: _providedOnDismiss,\n\n    // bottom sheet props\n    index: _providedIndex = 0,\n    snapPoints: _providedSnapPoints,\n    onChange: _providedOnChange,\n\n    // components\n    children,\n    ...bottomSheetProps\n  } = props;\n\n  //#region state\n  const [mount, setMount] = useState(false);\n  //#endregion\n\n  const {\n    containerHeight,\n    mountSheet,\n    unmountSheet,\n    willUnmountSheet,\n  } = useBottomSheetModalInternal();\n\n  //#region refs\n  const bottomSheetRef = useRef<BottomSheet>(null);\n  const isMinimized = useRef(false);\n  const isForcedDismissed = useRef(false);\n  const currentIndexRef = useRef(-1);\n  //#endregion\n\n  //#region variables\n  const key = useMemo(() => name || `bottom-sheet-modal-${nanoid()}`, [name]);\n  const index = useMemo(\n    () => (dismissOnPanDown ? _providedIndex + 1 : _providedIndex),\n    [_providedIndex, dismissOnPanDown]\n  );\n  const snapPoints = useMemo(\n    () =>\n      dismissOnPanDown ? [0, ..._providedSnapPoints] : _providedSnapPoints,\n    [_providedSnapPoints, dismissOnPanDown]\n  );\n  //#endregion\n\n  //#region callbacks\n  const doDismiss = useCallback(() => {\n    if (_providedOnDismiss) {\n      _providedOnDismiss();\n    }\n    setMount(false);\n    unmountSheet(key);\n\n    // reset\n    isMinimized.current = false;\n    isForcedDismissed.current = false;\n  }, [key, _providedOnDismiss, unmountSheet]);\n  const handleOnChange = useCallback(\n    (_index: number) => {\n      if (isMinimized.current && !isForcedDismissed.current) {\n        return;\n      }\n\n      const adjustedIndex = dismissOnPanDown ? _index - 1 : _index;\n      currentIndexRef.current = _index;\n\n      if (adjustedIndex >= 0) {\n        if (_providedOnChange) {\n          _providedOnChange(adjustedIndex);\n        }\n      } else {\n        doDismiss();\n      }\n    },\n    [dismissOnPanDown, _providedOnChange, doDismiss]\n  );\n  //#endregion\n\n  //#region private methods\n  const handleMinimize = useCallback(() => {\n    if (!isMinimized.current) {\n      isMinimized.current = true;\n      bottomSheetRef.current?.close();\n    }\n  }, []);\n  const handleRestore = useCallback(() => {\n    if (isMinimized.current) {\n      isMinimized.current = false;\n      bottomSheetRef.current?.snapTo(currentIndexRef.current);\n    }\n  }, []);\n  //#endregion\n\n  //#region public methods\n  const handlePresent = useCallback(() => {\n    requestAnimationFrame(() => {\n      setMount(true);\n      mountSheet(key, ref);\n    });\n  }, [key, mountSheet, ref]);\n  const handleDismiss = useCallback(\n    (force: boolean = false) => {\n      if (force) {\n        if (isMinimized.current) {\n          doDismiss();\n          return;\n        }\n        isForcedDismissed.current = true;\n        isMinimized.current = false;\n      } else {\n        willUnmountSheet(key);\n      }\n      bottomSheetRef.current?.close();\n    },\n    [key, doDismiss, willUnmountSheet]\n  );\n  const handleClose = useCallback(() => {\n    if (isMinimized.current) {\n      return;\n    }\n    bottomSheetRef.current?.close();\n  }, []);\n  const handleCollapse = useCallback(() => {\n    if (isMinimized.current) {\n      return;\n    }\n    if (dismissOnPanDown) {\n      bottomSheetRef.current?.snapTo(1);\n    } else {\n      bottomSheetRef.current?.collapse();\n    }\n  }, [dismissOnPanDown]);\n  const handleExpand = useCallback(() => {\n    if (isMinimized.current) {\n      return;\n    }\n    bottomSheetRef.current?.expand();\n  }, []);\n  const handleSnapTo = useCallback(\n    (_index: number) => {\n      if (isMinimized.current) {\n        return;\n      }\n      bottomSheetRef.current?.snapTo(_index + (dismissOnPanDown ? 1 : 0));\n    },\n    [dismissOnPanDown]\n  );\n  //#endregion\n\n  //#region expose public methods\n  useImperativeHandle(ref, () => ({\n    present: handlePresent,\n    dismiss: handleDismiss,\n    close: handleClose,\n    snapTo: handleSnapTo,\n    expand: handleExpand,\n    collapse: handleCollapse,\n    // private\n    minimize: handleMinimize,\n    restore: handleRestore,\n  }));\n  //#endregion\n\n  // render\n  return mount ? (\n    <Portal key={key} name={key}>\n      <BottomSheet\n        {...bottomSheetProps}\n        ref={bottomSheetRef}\n        key={key}\n        index={index}\n        snapPoints={snapPoints}\n        animateOnMount={true}\n        containerHeight={containerHeight}\n        onChange={handleOnChange}\n        children={children}\n      />\n    </Portal>\n  ) : null;\n});\n\nconst BottomSheetModal = memo(BottomSheetModalComponent, isEqual);\n\nexport default BottomSheetModal;\n"]}