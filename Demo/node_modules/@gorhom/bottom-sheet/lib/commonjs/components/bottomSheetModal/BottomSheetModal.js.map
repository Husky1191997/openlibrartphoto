{"version":3,"sources":["BottomSheetModal.tsx"],"names":["BottomSheetModalComponent","props","ref","name","dismissOnPanDown","DEFAULT_DISMISS_ON_PAN_DOWN","onDismiss","_providedOnDismiss","index","_providedIndex","snapPoints","_providedSnapPoints","onChange","_providedOnChange","children","bottomSheetProps","mount","setMount","containerHeight","mountSheet","unmountSheet","willUnmountSheet","bottomSheetRef","isMinimized","isForcedDismissed","currentIndexRef","key","doDismiss","current","handleOnChange","_index","adjustedIndex","handleMinimize","close","handleRestore","snapTo","handlePresent","requestAnimationFrame","handleDismiss","force","handleClose","handleCollapse","collapse","handleExpand","expand","handleSnapTo","present","dismiss","minimize","restore","BottomSheetModal","isEqual"],"mappings":"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","sourcesContent":["import React, {\n  forwardRef,\n  memo,\n  useCallback,\n  useImperativeHandle,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { Portal } from '@gorhom/portal';\nimport { nanoid } from 'nanoid/non-secure';\nimport isEqual from 'lodash.isequal';\nimport BottomSheet from '../bottomSheet';\nimport { useBottomSheetModalInternal } from '../../hooks';\nimport { DEFAULT_DISMISS_ON_PAN_DOWN } from './constants';\nimport type { BottomSheetModalMethods } from '../../types';\nimport type { BottomSheetModalProps } from './types';\n\ntype BottomSheetModal = BottomSheetModalMethods;\n\nconst BottomSheetModalComponent = forwardRef<\n  BottomSheetModal,\n  BottomSheetModalProps\n>((props, ref) => {\n  const {\n    // modal props\n    name,\n    dismissOnPanDown = DEFAULT_DISMISS_ON_PAN_DOWN,\n    onDismiss: _providedOnDismiss,\n\n    // bottom sheet props\n    index: _providedIndex = 0,\n    snapPoints: _providedSnapPoints,\n    onChange: _providedOnChange,\n\n    // components\n    children,\n    ...bottomSheetProps\n  } = props;\n\n  //#region state\n  const [mount, setMount] = useState(false);\n  //#endregion\n\n  const {\n    containerHeight,\n    mountSheet,\n    unmountSheet,\n    willUnmountSheet,\n  } = useBottomSheetModalInternal();\n\n  //#region refs\n  const bottomSheetRef = useRef<BottomSheet>(null);\n  const isMinimized = useRef(false);\n  const isForcedDismissed = useRef(false);\n  const currentIndexRef = useRef(-1);\n  //#endregion\n\n  //#region variables\n  const key = useMemo(() => name || `bottom-sheet-modal-${nanoid()}`, [name]);\n  const index = useMemo(\n    () => (dismissOnPanDown ? _providedIndex + 1 : _providedIndex),\n    [_providedIndex, dismissOnPanDown]\n  );\n  const snapPoints = useMemo(\n    () =>\n      dismissOnPanDown ? [0, ..._providedSnapPoints] : _providedSnapPoints,\n    [_providedSnapPoints, dismissOnPanDown]\n  );\n  //#endregion\n\n  //#region callbacks\n  const doDismiss = useCallback(() => {\n    if (_providedOnDismiss) {\n      _providedOnDismiss();\n    }\n    setMount(false);\n    unmountSheet(key);\n\n    // reset\n    isMinimized.current = false;\n    isForcedDismissed.current = false;\n  }, [key, _providedOnDismiss, unmountSheet]);\n  const handleOnChange = useCallback(\n    (_index: number) => {\n      if (isMinimized.current && !isForcedDismissed.current) {\n        return;\n      }\n\n      const adjustedIndex = dismissOnPanDown ? _index - 1 : _index;\n      currentIndexRef.current = _index;\n\n      if (adjustedIndex >= 0) {\n        if (_providedOnChange) {\n          _providedOnChange(adjustedIndex);\n        }\n      } else {\n        doDismiss();\n      }\n    },\n    [dismissOnPanDown, _providedOnChange, doDismiss]\n  );\n  //#endregion\n\n  //#region private methods\n  const handleMinimize = useCallback(() => {\n    if (!isMinimized.current) {\n      isMinimized.current = true;\n      bottomSheetRef.current?.close();\n    }\n  }, []);\n  const handleRestore = useCallback(() => {\n    if (isMinimized.current) {\n      isMinimized.current = false;\n      bottomSheetRef.current?.snapTo(currentIndexRef.current);\n    }\n  }, []);\n  //#endregion\n\n  //#region public methods\n  const handlePresent = useCallback(() => {\n    requestAnimationFrame(() => {\n      setMount(true);\n      mountSheet(key, ref);\n    });\n  }, [key, mountSheet, ref]);\n  const handleDismiss = useCallback(\n    (force: boolean = false) => {\n      if (force) {\n        if (isMinimized.current) {\n          doDismiss();\n          return;\n        }\n        isForcedDismissed.current = true;\n        isMinimized.current = false;\n      } else {\n        willUnmountSheet(key);\n      }\n      bottomSheetRef.current?.close();\n    },\n    [key, doDismiss, willUnmountSheet]\n  );\n  const handleClose = useCallback(() => {\n    if (isMinimized.current) {\n      return;\n    }\n    bottomSheetRef.current?.close();\n  }, []);\n  const handleCollapse = useCallback(() => {\n    if (isMinimized.current) {\n      return;\n    }\n    if (dismissOnPanDown) {\n      bottomSheetRef.current?.snapTo(1);\n    } else {\n      bottomSheetRef.current?.collapse();\n    }\n  }, [dismissOnPanDown]);\n  const handleExpand = useCallback(() => {\n    if (isMinimized.current) {\n      return;\n    }\n    bottomSheetRef.current?.expand();\n  }, []);\n  const handleSnapTo = useCallback(\n    (_index: number) => {\n      if (isMinimized.current) {\n        return;\n      }\n      bottomSheetRef.current?.snapTo(_index + (dismissOnPanDown ? 1 : 0));\n    },\n    [dismissOnPanDown]\n  );\n  //#endregion\n\n  //#region expose public methods\n  useImperativeHandle(ref, () => ({\n    present: handlePresent,\n    dismiss: handleDismiss,\n    close: handleClose,\n    snapTo: handleSnapTo,\n    expand: handleExpand,\n    collapse: handleCollapse,\n    // private\n    minimize: handleMinimize,\n    restore: handleRestore,\n  }));\n  //#endregion\n\n  // render\n  return mount ? (\n    <Portal key={key} name={key}>\n      <BottomSheet\n        {...bottomSheetProps}\n        ref={bottomSheetRef}\n        key={key}\n        index={index}\n        snapPoints={snapPoints}\n        animateOnMount={true}\n        containerHeight={containerHeight}\n        onChange={handleOnChange}\n        children={children}\n      />\n    </Portal>\n  ) : null;\n});\n\nconst BottomSheetModal = memo(BottomSheetModalComponent, isEqual);\n\nexport default BottomSheetModal;\n"]}